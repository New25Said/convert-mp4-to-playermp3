<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Convertidor MP4 a AVI</title>
  https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js</script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h2 {
      color: #333;
    }
    .console {
      background: #000;
      color: #0f0;
      padding: 10px;
      font-family: monospace;
      height: 200px;
      overflow-y: auto;
      border-radius: 5px;
      white-space: pre-wrap;
      margin-top: 20px;
    }
    input, button {
      margin-top: 10px;
      padding: 8px;
      font-size: 16px;
    }
    button {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>üé¨ Convertidor MP4 a AVI (320x240 con bordes negros)</h2>
  <input type="file" id="videoInput" accept=".mp4"><br>
  <button onclick="convertVideo()">Convertir</button>
  <div class="console" id="console">[ Consola de estado ]</div>

  <script>
    function log(msg) {
      const consoleDiv = document.getElementById('console');
      consoleDiv.innerHTML += `\n${msg}`;
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    async function convertVideo() {
      const fileInput = document.getElementById('videoInput');
      if (!fileInput.files.length) {
        log("‚ùå No se seleccion√≥ ning√∫n archivo.");
        return;
      }

      const file = fileInput.files[0];
      log(`üì• Archivo seleccionado: ${file.name}`);

      try {
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        log("üîÑ Inicializando FFmpeg...");
        await ffmpeg.load();
        log("‚úÖ FFmpeg cargado correctamente.");

        const inputName = 'input.mp4';
        const outputName = 'output.avi';

        log("üì§ Cargando archivo en memoria...");
        ffmpeg.FS('writeFile', inputName, await fetchFile(file));

        log("‚öôÔ∏è Ejecutando conversi√≥n...");
        await ffmpeg.run(
          '-i', inputName,
          '-vf', 'scale=320:240:force_original_aspect_ratio=decrease,pad=320:240:(ow-iw)/2:(oh-ih)/2:black',
          '-c:v', 'mpeg4',
          '-c:a', 'pcm_s16le',
          outputName
        );

        log("‚úÖ Conversi√≥n completada.");
        const data = ffmpeg.FS('readFile', outputName);
        const videoBlob = new Blob([data.buffer], { type: 'video/avi' });
        const url = URL.createObjectURL(videoBlob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'convertido.avi';
        a.textContent = '‚¨áÔ∏è Descargar AVI';
        a.style.display = 'block';
        a.style.marginTop = '10px';
        document.body.appendChild(a);
      } catch (err) {
        log("‚ùå Error durante la conversi√≥n.");
        log("Detalles: " + (err.message || err.toString()));
        console.error(err);
      }
    }
  </script>
</body>
</html>
